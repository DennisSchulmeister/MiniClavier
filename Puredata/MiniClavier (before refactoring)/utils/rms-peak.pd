#N canvas 0 49 1920 1009 12;
#X obj -30 -30 preset_hub k12 1 %hidden%;
#X text 10 40 Calculates the spontaneous and average RMS values of
an audio signal for display in a VU meter. The peak value will slowly
ramp down to minus 100db after a short while., f 68;
#X obj 100 200 inlet~;
#X obj 100 980 outlet;
#X obj 300 980 outlet;
#X text 100 1010 Current RMS;
#X text 300 1010 Peak RMS;
#X text 10 10 RMS/Peak Calculator;
#X obj 100 270 env~;
#X obj 100 299 - 100;
#X obj 130 530 expr max($f1 \, \\$f2);
#X obj 130 470 trigger b f, f 18;
#X obj 130 800 line;
#X obj 520 230 loadbang;
#X obj 500 259 bng 15 250 50 0 empty empty empty 17 7 0 10 #fcfcfc
#000000 #000000 1;
#X obj 500 200 inlet;
#X msg 500 290 -999;
#X obj 130 500 value _\$0_peak;
#X obj 100 330 trigger f f;
#X obj 500 320 value _\$0_rms;
#X obj 620 320 value _\$0_peak;
#X text 10 110 Send a bang to the right inlet to reset the values.
, f 68;
#X obj 140 360 value _\$0_rms;
#X obj 100 930 value _\$0_rms;
#X obj 300 930 value _\$0_peak;
#X obj 100 430 trigger b f;
#X obj 100 900 trigger b b;
#X text 110 880 ---- Output calculated values ----;
#X text 110 250 ---- Calculate current RMS in dB ----;
#X text 110 410 ---- Calculate peak RMS with ramp down ----;
#X obj 130 830 value _\$0_peak;
#X obj 130 590 expr if($f1 > _\$0_peak \, 1 \, 0);
#X obj 130 619 select 1;
#X obj 130 559 trigger f f, f 38;
#X obj 130 650 pack f f, f 38;
#X text 270 530 max(prev_peak_rms \, current_rms);
#X text 410 590 Is current_rms > prev_peak_rms?;
#X floatatom 360 980 5 0 0 0 - - - 0 0 1, f 5;
#X floatatom 160 980 5 0 0 0 - - - 0 0 1, f 5;
#X text 170 680 Jump to new value \, wait \, then ramp down;
#X obj 160 740 delay 3000;
#X msg 160 770 -100 5000;
#X msg 130 680 \$2;
#X obj 130 710 trigger f b;
#X connect 2 0 8 0;
#X connect 8 0 9 0;
#X connect 9 0 18 0;
#X connect 10 0 33 0;
#X connect 11 0 17 0;
#X connect 11 1 10 1;
#X connect 12 0 30 0;
#X connect 13 0 14 0;
#X connect 14 0 16 0;
#X connect 15 0 14 0;
#X connect 16 0 19 0;
#X connect 16 0 20 0;
#X connect 17 0 10 0;
#X connect 18 0 25 0;
#X connect 18 1 22 0;
#X connect 23 0 3 0;
#X connect 23 0 38 0;
#X connect 24 0 4 0;
#X connect 24 0 37 0;
#X connect 25 0 26 0;
#X connect 25 1 11 0;
#X connect 26 0 23 0;
#X connect 26 1 24 0;
#X connect 31 0 32 0;
#X connect 32 0 34 0;
#X connect 33 0 31 0;
#X connect 33 1 34 1;
#X connect 34 0 42 0;
#X connect 40 0 41 0;
#X connect 41 0 12 0;
#X connect 42 0 43 0;
#X connect 43 0 12 0;
#X connect 43 1 40 0;
