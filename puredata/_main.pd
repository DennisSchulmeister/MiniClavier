#N struct vac__voice float x float y float voice float note float velocity
float active float time float sustain float sustenuto float bg_color
float sustain_color float sustenuto_color;
#N struct vac__main float polyphony array voices vac__voice;
#N canvas 0 49 1920 1009 12;
#X obj -30 -30 preset_hub k12 1 %hidden%;
#N canvas 0 49 1920 1009 chorus 0;
#X obj 100 100 inlet~;
#X obj 230 100 inlet~;
#X obj 100 920 outlet~;
#X obj 600 920 outlet~;
#X floatatom 1120 130 5 0 0 1 Dry/Wet - - 0 0 1, f 5;
#X floatatom 940 130 5 0 0 1 Feedback_% - - 0 0 1, f 5;
#X floatatom 560 130 5 0 0 1 LFO_Frequency_Hz - - 0 0 1, f 5;
#X floatatom 760 130 5 0 0 1 LFO_Width_ms - - 0 0 1, f 5;
#X floatatom 1520 130 5 0 0 1 Enabled - - 0 0 1, f 5;
#X obj 560 100 r p-cho-frequency;
#X obj 760 100 r p-cho-width;
#X obj 940 100 r p-cho-feedback;
#X obj 1120 100 r p-cho-drywet;
#X obj 1520 100 r p-cho-enabled;
#X obj 100 130 s~ cho-s-dry1;
#X obj 230 130 s~ cho-s-dry2;
#X obj 230 840 r~ cho-s-dry1;
#X obj 100 300 r~ cho-s-dry1;
#X obj 100 600 s~ cho-s-wet1;
#X obj 100 760 *~;
#X obj 250 760 *~;
#X obj 100 700 r~ cho-s-dry1;
#X obj 250 700 r~ cho-s-wet1;
#X obj 140 730 r cho-dry;
#X obj 290 730 r cho-wet;
#X obj 600 760 *~;
#X obj 750 760 *~;
#X obj 640 730 r cho-dry;
#X obj 790 730 r cho-wet;
#X obj 600 700 r~ cho-s-dry2;
#X obj 750 700 r~ cho-s-wet2;
#X floatatom 1310 260 5 0 1 1 Wet - - 0 0 1, f 5;
#X floatatom 1120 260 5 0 1 1 Dry - - 0 0 1, f 5;
#X obj 1120 230 expr sqrt(($f1 + 1) / 2);
#X obj 1120 200 * -1;
#X obj 1310 230 expr sqrt(($f1 + 1) / 2);
#X obj 1120 290 s cho-dry;
#X obj 1310 290 s cho-wet;
#X floatatom 400 130 5 0 0 1 Delay_ms - - 0 0 1, f 5;
#X obj 400 100 r p-cho-delay;
#X obj 1520 187 s cho-enabled;
#X obj 340 840 r cho-enabled;
#X obj 560 187 s cho-frequency;
#X obj 400 187 s cho-delay;
#X obj 760 187 s cho-width;
#X obj 940 187 s cho-feedback;
#X obj 170 390 r cho-frequency;
#X obj 150 360 r cho-delay;
#X obj 190 420 r cho-width;
#X obj 210 450 r cho-feedback;
#X obj 230 870 expr~ \\$v1 * ($f2 - 1) * -1;
#X obj 120 840 r cho-enabled;
#X obj 100 870 *~;
#X obj 100 800 +~;
#X obj 840 840 r cho-enabled;
#X obj 730 870 expr~ \\$v1 * ($f2 - 1) * -1;
#X obj 620 840 r cho-enabled;
#X obj 600 870 *~;
#X obj 600 800 +~;
#X obj 730 840 r~ cho-s-dry2;
#X text 10 10 Simple chorus/flanger effect;
#X obj 560 160 ./utils/declick;
#X obj 400 160 ./utils/declick;
#X obj 760 158 ./utils/declick;
#X obj 940 158 ./utils/declick;
#X obj 1120 160 ./utils/declick;
#X obj 1520 158 ./utils/declick;
#X obj 100 520 ./chorus/chorus;
#X obj 120 330 r~ cho-s-dry2;
#X obj 220 600 s~ cho-s-wet2;
#X connect 0 0 14 0;
#X connect 1 0 15 0;
#X connect 4 0 65 0;
#X connect 5 0 64 0;
#X connect 6 0 61 0;
#X connect 7 0 63 0;
#X connect 8 0 66 0;
#X connect 9 0 6 0;
#X connect 10 0 7 0;
#X connect 11 0 5 0;
#X connect 12 0 4 0;
#X connect 13 0 8 0;
#X connect 16 0 50 0;
#X connect 17 0 67 0;
#X connect 19 0 53 0;
#X connect 20 0 53 1;
#X connect 21 0 19 0;
#X connect 22 0 20 0;
#X connect 23 0 19 1;
#X connect 24 0 20 1;
#X connect 25 0 58 0;
#X connect 26 0 58 0;
#X connect 27 0 25 1;
#X connect 28 0 26 1;
#X connect 29 0 25 0;
#X connect 30 0 26 0;
#X connect 31 0 37 0;
#X connect 32 0 36 0;
#X connect 33 0 32 0;
#X connect 34 0 33 0;
#X connect 35 0 31 0;
#X connect 38 0 62 0;
#X connect 39 0 38 0;
#X connect 41 0 50 1;
#X connect 46 0 67 3;
#X connect 47 0 67 2;
#X connect 48 0 67 4;
#X connect 49 0 67 5;
#X connect 50 0 2 0;
#X connect 51 0 52 1;
#X connect 52 0 2 0;
#X connect 53 0 52 0;
#X connect 54 0 55 1;
#X connect 55 0 3 0;
#X connect 56 0 57 1;
#X connect 57 0 3 0;
#X connect 58 0 57 0;
#X connect 59 0 55 0;
#X connect 61 0 42 0;
#X connect 62 0 43 0;
#X connect 63 0 44 0;
#X connect 64 0 45 0;
#X connect 65 0 34 0;
#X connect 65 0 35 0;
#X connect 66 0 40 0;
#X connect 67 0 18 0;
#X connect 67 1 69 0;
#X connect 68 0 67 1;
#X restore 100 330 pd chorus;
#N canvas 0 49 1920 1009 reverb 0;
#X obj 100 100 inlet~;
#X obj 220 100 inlet~;
#X obj 100 1020 outlet~;
#X obj 800 1020 outlet~;
#X obj 100 580 rev3~ 100;
#X floatatom 400 130 5 0 0 0 - - - 0 0 1, f 5;
#X floatatom 350 420 5 0 100 1 % - - 0 0 1, f 5;
#X floatatom 570 480 5 0 0 1 Hz - - 0 0 1, f 5;
#X floatatom 730 420 5 0 100 1 % - - 0 0 1, f 5;
#X floatatom 630 260 5 0 1 1 Wet - - 0 0 1, f 5;
#X floatatom 400 260 5 0 1 1 Dry - - 0 0 1, f 5;
#X obj 100 860 *~;
#X obj 800 860 *~;
#X obj 250 860 *~;
#X obj 950 860 *~;
#X obj 400 230 expr sqrt(($f1 + 1) / 2);
#X obj 400 200 * -1;
#X obj 630 230 expr sqrt(($f1 + 1) / 2);
#X obj 350 480 expr cbrt($f1 / 100) * 100;
#X floatatom 350 510 5 0 0 1 % - - 0 0 1, f 5;
#X floatatom 730 510 5 0 0 1 % - - 0 0 1, f 5;
#X obj 730 480 expr sqrt($f1 / 100) * 100;
#X floatatom 900 130 5 0 0 1 Enabled - - 0 0 1, f 5;
#X obj 100 130 s~ rev-s-dry1;
#X obj 220 130 s~ rev-s-dry2;
#X obj 400 100 r p-rev-drywet;
#X obj 400 290 s rev-dry;
#X obj 630 290 s rev-wet;
#X obj 900 100 r p-rev-enabled;
#X obj 100 390 r~ rev-s-dry1;
#X obj 220 390 r~ rev-s-dry2;
#X obj 350 390 r p-rev-length;
#X obj 570 450 r p-rev-crossover;
#X obj 730 390 r p-rev-hfdamping;
#X obj 100 680 s~ rev-s-wet1;
#X obj 230 680 s~ rev-s-wet2;
#X obj 100 800 r~ rev-s-dry1;
#X obj 250 800 r~ rev-s-wet1;
#X obj 800 800 r~ rev-s-dry2;
#X obj 950 800 r~ rev-s-wet2;
#X obj 140 830 r rev-dry;
#X obj 290 830 r rev-wet;
#X obj 840 830 r rev-dry;
#X obj 990 830 r rev-wet;
#X obj 900 189 s rev-enabled;
#X obj 230 970 expr~ \\$v1 * ($f2 - 1) * -1;
#X obj 100 970 *~;
#X obj 100 900 +~;
#X obj 120 940 r rev-enabled;
#X obj 230 940 r~ rev-s-dry1;
#X obj 340 940 r rev-enabled;
#X obj 930 970 expr~ \\$v1 * ($f2 - 1) * -1;
#X obj 800 970 *~;
#X obj 800 900 +~;
#X obj 820 940 r rev-enabled;
#X obj 1040 940 r rev-enabled;
#X obj 930 940 r~ rev-s-dry2;
#X text 10 10 Even simpler reverb effect using PD's [rev3~];
#X obj 400 158 ./utils/declick;
#X obj 900 160 ./utils/declick;
#X obj 350 450 ./utils/declick;
#X obj 730 450 ./utils/declick;
#X obj 570 508 ./utils/declick;
#X connect 0 0 23 0;
#X connect 1 0 24 0;
#X connect 4 0 34 0;
#X connect 4 1 35 0;
#X connect 5 0 58 0;
#X connect 6 0 60 0;
#X connect 7 0 62 0;
#X connect 8 0 61 0;
#X connect 9 0 27 0;
#X connect 10 0 26 0;
#X connect 11 0 47 0;
#X connect 12 0 53 0;
#X connect 13 0 47 1;
#X connect 14 0 53 1;
#X connect 15 0 10 0;
#X connect 16 0 15 0;
#X connect 17 0 9 0;
#X connect 18 0 19 0;
#X connect 19 0 4 3;
#X connect 20 0 4 5;
#X connect 21 0 20 0;
#X connect 22 0 59 0;
#X connect 25 0 5 0;
#X connect 28 0 22 0;
#X connect 29 0 4 0;
#X connect 30 0 4 1;
#X connect 31 0 6 0;
#X connect 32 0 7 0;
#X connect 33 0 8 0;
#X connect 36 0 11 0;
#X connect 37 0 13 0;
#X connect 38 0 12 0;
#X connect 39 0 14 0;
#X connect 40 0 11 1;
#X connect 41 0 13 1;
#X connect 42 0 12 1;
#X connect 43 0 14 1;
#X connect 45 0 2 0;
#X connect 46 0 2 0;
#X connect 47 0 46 0;
#X connect 48 0 46 1;
#X connect 49 0 45 0;
#X connect 50 0 45 1;
#X connect 51 0 3 0;
#X connect 52 0 3 0;
#X connect 53 0 52 0;
#X connect 54 0 52 1;
#X connect 55 0 51 1;
#X connect 56 0 51 0;
#X connect 58 0 16 0;
#X connect 58 0 17 0;
#X connect 59 0 44 0;
#X connect 60 0 18 0;
#X connect 61 0 21 0;
#X connect 62 0 4 4;
#X restore 100 360 pd reverb;
#N canvas 0 49 1920 1009 midi_input 0;
#X obj 100 200 notein 1;
#X floatatom 100 230 5 0 0 1 Note - - 0 0 1, f 5;
#X floatatom 200 230 5 0 0 1 Velocity - - 0 0 1, f 5;
#X obj 700 200 ctlin 64 1;
#X floatatom 700 230 5 0 0 1 Sustain - - 0 0 1, f 5;
#X obj 100 420 ctlin 7 1;
#X floatatom 100 450 5 0 0 1 Volume_MSB - - 0 0 0, f 5;
#X obj 1200 420 ctlin 11 1;
#X floatatom 1200 450 5 0 0 1 Expression_MSB - - 0 0 1, f 5;
#X obj 400 200 bendin 1 1;
#X obj 400 260 expr (($i1 / 16383) * 2) - 1;
#X floatatom 400 230 5 0 0 1 Pitchbend - - 0 0 0, f 5;
#X floatatom 900 230 5 0 0 1 Sustenuto - - 0 0 1, f 5;
#X obj 900 200 ctlin 66 1;
#X obj 200 260 / 127;
#X obj 700 260 / 127;
#X obj 900 260 / 127;
#X obj 100 480 / 127;
#X obj 1200 480 / 127;
#X text 10 10 MIDI Input Handling;
#X text 10 90 All objects below are listening in MIDI channel 1;
#X floatatom 430 450 5 0 0 1 Panorama_MSB - - 0 0 1, f 5;
#X obj 430 480 / 127;
#X obj 430 420 ctlin 10 1;
#X floatatom 240 450 5 0 0 1 Volume_LSB - - 0 0 0, f 5;
#X obj 240 420 ctlin 39 1;
#X obj 100 550 +;
#X obj 240 480 / 16384;
#X obj 240 510 trigger b f;
#X floatatom 1380 450 5 0 0 1 Expression_LSB - - 0 0 0, f 5;
#X obj 1380 480 / 16384;
#X obj 1380 510 trigger b f;
#X obj 1380 420 ctlin 43 1;
#X obj 1200 560 +;
#X floatatom 600 450 5 0 0 1 Panorama_LSB - - 0 0 0, f 5;
#X obj 600 480 / 16384;
#X obj 600 510 trigger b f;
#X obj 600 420 ctlin 42 1;
#X obj 430 560 +;
#X floatatom 200 290 5 0 0 0 - - - 0 0 1, f 5;
#X floatatom 400 290 5 0 0 0 - - - 0 0 1, f 5;
#X floatatom 700 290 5 0 0 0 - - - 0 0 1, f 5;
#X floatatom 900 290 5 0 0 0 - - - 0 0 1, f 5;
#X floatatom 100 580 5 0 0 0 - - - 0 0 1, f 5;
#X floatatom 1200 590 5 0 0 0 - - - 0 0 1, f 5;
#X floatatom 430 590 5 0 0 0 - - - 0 0 1, f 5;
#X floatatom 800 450 5 0 0 1 Modulation_MSB - - 0 0 1, f 5;
#X obj 800 480 / 127;
#X floatatom 970 450 5 0 0 1 Modulation_LSB - - 0 0 0, f 5;
#X obj 970 480 / 16384;
#X obj 970 510 trigger b f;
#X obj 800 550 +;
#X floatatom 800 580 5 0 0 0 - - - 0 0 1, f 5;
#X obj 800 420 ctlin 1 1;
#X obj 970 420 ctlin 33 1;
#X obj 100 320 s in-note;
#X obj 200 320 s in-velocity;
#X obj 400 320 s in-pitchbend;
#X obj 700 320 s in-sustain;
#X obj 900 320 s in-sustenuto;
#X obj 100 610 s p-glb-volume;
#X obj 430 620 s p-glb-panorama;
#X obj 800 610 s in-modulation;
#X obj 1200 620 s in-expression;
#X text 10 40 This subpatch receives the MIDI input \, normalizes it
and sends the resulting values to everybody who wants to receive them.
, f 63;
#X connect 0 0 1 0;
#X connect 0 1 2 0;
#X connect 1 0 55 0;
#X connect 2 0 14 0;
#X connect 3 0 4 0;
#X connect 4 0 15 0;
#X connect 5 0 6 0;
#X connect 6 0 17 0;
#X connect 7 0 8 0;
#X connect 8 0 18 0;
#X connect 9 0 11 0;
#X connect 10 0 40 0;
#X connect 11 0 10 0;
#X connect 12 0 16 0;
#X connect 13 0 12 0;
#X connect 14 0 39 0;
#X connect 15 0 41 0;
#X connect 16 0 42 0;
#X connect 17 0 26 0;
#X connect 18 0 33 0;
#X connect 21 0 22 0;
#X connect 22 0 38 0;
#X connect 23 0 21 0;
#X connect 24 0 27 0;
#X connect 25 0 24 0;
#X connect 26 0 43 0;
#X connect 27 0 28 0;
#X connect 28 0 26 0;
#X connect 28 1 26 1;
#X connect 29 0 30 0;
#X connect 30 0 31 0;
#X connect 31 0 33 0;
#X connect 31 1 33 1;
#X connect 32 0 29 0;
#X connect 33 0 44 0;
#X connect 34 0 35 0;
#X connect 35 0 36 0;
#X connect 36 0 38 0;
#X connect 36 1 38 1;
#X connect 37 0 34 0;
#X connect 38 0 45 0;
#X connect 39 0 56 0;
#X connect 40 0 57 0;
#X connect 41 0 58 0;
#X connect 42 0 59 0;
#X connect 43 0 60 0;
#X connect 44 0 63 0;
#X connect 45 0 61 0;
#X connect 46 0 47 0;
#X connect 47 0 51 0;
#X connect 48 0 49 0;
#X connect 49 0 50 0;
#X connect 50 0 51 0;
#X connect 50 1 51 1;
#X connect 51 0 52 0;
#X connect 52 0 62 0;
#X connect 53 0 46 0;
#X connect 54 0 48 0;
#X coords 0 0 1 1 95 60 0;
#X restore 100 130 pd midi_input;
#N canvas 0 49 1920 1009 volume_and_pan 0;
#X obj 200 180 inlet~;
#X obj 200 540 outlet~;
#X obj 300 540 outlet~;
#X floatatom 300 210 5 0 0 1 Volume - - 0 0 0, f 5;
#X floatatom 450 210 5 0 0 1 Expression - - 0 0 0, f 5;
#X floatatom 630 210 5 0 0 1 Panorama - - 0 0 0, f 5;
#X obj 300 330 *;
#X floatatom 300 360 5 0 0 0 - - - 0 0 1, f 5;
#X obj 450 270 trigger b f;
#X obj 200 430 *~;
#X obj 630 360 expr sqrt(($f1 + 1) / 2);
#X obj 630 330 * -1;
#X obj 860 360 expr sqrt(($f1 + 1) / 2);
#X floatatom 630 390 5 0 0 0 - - - 0 0 1, f 5;
#X floatatom 860 390 5 0 0 0 - - - 0 0 1, f 5;
#X obj 630 270 trigger f f;
#X obj 200 480 *~;
#X obj 300 480 *~;
#X obj 300 180 r p-glb-volume;
#X obj 450 180 r in-expression;
#X obj 630 180 r p-glb-panorama;
#X text 10 10 Total volume and panorama handling;
#X obj 300 240 ./utils/declick;
#X obj 450 240 ./utils/declick;
#X obj 630 240 ./utils/declick;
#X connect 0 0 9 0;
#X connect 3 0 22 0;
#X connect 4 0 23 0;
#X connect 5 0 24 0;
#X connect 6 0 7 0;
#X connect 7 0 9 1;
#X connect 8 0 6 0;
#X connect 8 1 6 1;
#X connect 9 0 17 0;
#X connect 9 0 16 0;
#X connect 10 0 13 0;
#X connect 11 0 10 0;
#X connect 12 0 14 0;
#X connect 13 0 16 1;
#X connect 14 0 17 1;
#X connect 15 0 11 0;
#X connect 15 1 12 0;
#X connect 16 0 1 0;
#X connect 17 0 2 0;
#X connect 18 0 3 0;
#X connect 19 0 4 0;
#X connect 20 0 5 0;
#X connect 22 0 6 0;
#X connect 23 0 8 0;
#X connect 24 0 15 0;
#X restore 100 300 pd volume_and_pan;
#X obj 100 270 /~ 8;
#N canvas 0 49 1920 1009 audio_output 0;
#X obj 100 100 inlet~;
#X obj 100 200 hip~ 1;
#X obj 100 229 clip~ -1 1;
#X obj 230 290 dac~;
#X obj 400 100 inlet~;
#X obj 400 200 hip~ 1;
#X obj 400 229 clip~ -1 1;
#X text 600 200 Remove DC Bias;
#X text 600 230 Clip output to [-1 \, 1];
#X text 10 10 Final output stage to remove DC bias and clip values
;
#X obj 100 400 s out-vu-rms1;
#X obj 130 370 s out-vu-peak1;
#X obj 430 368 s out-vu-peak2;
#X obj 400 398 s out-vu-rms2;
#X obj 100 340 ./utils/rms-peak;
#X obj 400 338 ./utils/rms-peak;
#X obj 100 150 *~;
#X obj 400 148 *~;
#X obj 900 100 r p-out-mastervolume;
#X obj 900 130 expr pow(10 \, \\$f1 / 20);
#X text 1070 130 Conversion from dB;
#X obj 900 159 s \$0-aout-matervolume;
#X obj 440 150 r \$0-aout-matervolume;
#X obj 140 150 r \$0-aout-matervolume;
#X text 600 150 Apply master volume;
#X text 600 340 VU Meters;
#X connect 0 0 16 0;
#X connect 1 0 2 0;
#X connect 2 0 3 0;
#X connect 2 0 14 0;
#X connect 4 0 17 0;
#X connect 5 0 6 0;
#X connect 6 0 3 1;
#X connect 6 0 15 0;
#X connect 14 0 10 0;
#X connect 14 1 11 0;
#X connect 15 0 13 0;
#X connect 15 1 12 0;
#X connect 16 0 1 0;
#X connect 17 0 5 0;
#X connect 18 0 19 0;
#X connect 19 0 21 0;
#X connect 22 0 17 1;
#X connect 23 0 16 1;
#X restore 100 390 pd audio_output;
#X obj 100 240 clone voice 32;
#X obj 700 130 loadbang;
#X text 100 100 ---- Signal flow ----;
#X text 700 100 ---- Parameter initialization ----;
#X text 10 10 MiniClavier Synthesizer (backend without the GUI);
#X obj 100 210 ./voice_allocator/voice_allocator 32;
#X obj 100 180 r in-note;
#X obj 190 180 r in-velocity;
#X obj 310 180 r in-sustain;
#X obj 420 180 r in-sustenuto;
#X msg 700 160 p-out-mastervolume 0 \; \; p-glb-volume 1 \; p-glb-panorama
0 \; p-glb-pbrange 2 \; \; in-expression 1 \; in-pitchbend 0 \; in-modulation
0 \; in-sustain 0 \; in-sustenuto 0 \; \; p-cho-frequency 1.5 \; p-cho-delay
30 \; p-cho-width 1.8 \; p-cho-feedback 0 \; p-cho-drywet 0.75 \; p-cho-enabled
1 \; \; p-rev-length 33 \; p-rev-crossover 3000 \; p-rev-hfdamping
20 \; p-rev-drywet 0 \; p-rev-enabled 1 \;;
#X connect 1 0 2 0;
#X connect 1 1 2 1;
#X connect 2 0 6 0;
#X connect 2 1 6 1;
#X connect 4 0 1 0;
#X connect 4 1 1 1;
#X connect 5 0 4 0;
#X connect 7 0 5 0;
#X connect 8 0 17 0;
#X connect 12 0 7 0;
#X connect 13 0 12 0;
#X connect 14 0 12 1;
#X connect 15 0 12 2;
#X connect 16 0 12 3;
