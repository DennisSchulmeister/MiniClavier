#N canvas 0 49 1920 1009 12;
#X obj 0 30 cnv 15 600 250 empty empty empty 20 12 0 14 #f5f5f5 #404040
0;
#X obj -30 -30 preset_hub k12 1 %hidden%;
#X text 10 40 \$1 must be the prefix to receive parameters \, e.g.
"p-p1-car1", f 82;
#X obj 700 100 inlet;
#X obj 700 1261 outlet;
#X text 10 80 \$3 must be the number of wavetables (e.g. 11 for 1/octave)
\, starting with one., f 82;
#X text 10 230 For all this to work \, the synthesizer must have loaded
the basic waveforms with the [wavetables/xx/wavetable-xx] objects.
, f 82;
#X obj 30 350 r \$1-enabled;
#X obj 130 350 r \$1-waveform;
#X obj 280 350 r \$1-volume;
#X obj 380 350 r \$1-panorama;
#X obj 0 0 cnv 15 600 30 empty empty Addition\ of\ a\ single\ harmonic\ to\ the\ carrier\ or\ modulator\ wavetables
12 12 0 14 #e0e0e0 #404040 0;
#X text 30 320 ==== Detect parameter changes ====;
#X obj 30 500 s \$2-recalc;
#X obj 0 280 cnv 10 600 10 empty empty empty 20 12 0 14 #e0e0e0 #404040
0;
#X text 700 70 ==== Recalc wavetables ====;
#X text 10 60 \$2 must be the prefix of the wavetable arrays to which
the harmonic is added., f 82;
#X text 10 150 When a parameter change is detected \, a bang is sent
to \$2-recalc. You may delay this bang to throttle the recalcs and
then send it back to the inlet of the fist harmonic. Its outlet will
bang when the processing is done \, so that the harmonics can simply
be chained., f 82;
#X obj 700 150 trigger b b;
#X obj 730 190 ./utils/for-loop 1 \$3;
#X obj 760 250 ./utils/for-loop 1 2;
#X obj 910 390 select 1 2;
#X obj 760 220 trigger b f;
#X obj 820 420 symbol \$2;
#X text 890 190 Wavetable number;
#X text 910 250 Left/Right;
#X text 10 100 \$4 must be the harmonic number \, starting from one.
, f 82;
#X obj 30 621 r \$1-enabled;
#X obj 140 621 r \$1-volume;
#X obj 250 622 r \$1-panorama;
#X floatatom 30 651 5 0 0 0 - - - 0 0 1, f 5;
#X floatatom 140 651 5 0 0 0 - - - 0 0 1, f 5;
#X floatatom 250 651 5 0 0 0 - - - 0 0 1, f 5;
#X obj 30 970 expr \\$f1 * \\$f2 * sqrt(($f3 + 1) / 2);
#X text 30 591 ==== Calculate amplitude scaling factors ====;
#X obj 140 681 trigger b f;
#X obj 250 681 trigger b f;
#X obj 30 870 r \$1-enabled;
#X obj 140 870 r \$1-volume;
#X obj 250 870 r \$1-panorama;
#X floatatom 30 900 5 0 0 0 - - - 0 0 1, f 5;
#X floatatom 140 900 5 0 0 0 - - - 0 0 1, f 5;
#X floatatom 250 899 5 0 0 0 - - - 0 0 1, f 5;
#X obj 140 930 trigger b f;
#X obj 250 929 trigger b f;
#X text 710 130 ---- Loop over each wavetable ----;
#X floatatom 30 440 5 0 0 0 - - - 0 0 1, f 5;
#X floatatom 130 440 5 0 0 0 - - - 0 0 1, f 5;
#X floatatom 280 440 5 0 0 0 - - - 0 0 1, f 5;
#X floatatom 380 440 5 0 0 0 - - - 0 0 1, f 5;
#X floatatom 30 770 5 0 0 0 - - - 0 0 1, f 5;
#X floatatom 30 1000 5 0 0 0 - - - 0 0 1, f 5;
#X obj 1190 390 select 1 2;
#X obj 130 380 trigger b f;
#X msg 910 420 symbol L;
#X msg 980 420 symbol R;
#X obj 820 670 select 0 1 2 3;
#X msg 820 700 symbol sin;
#X text 800 310 ---- Calculate target wavetable name ----;
#X msg 910 700 symbol saw;
#X msg 1000 700 symbol square;
#X msg 1110 700 symbol triangle;
#X text 800 560 ---- Calculate source wavetable name ----;
#X obj 30 470 bang;
#X obj 1060 420 value _\$0_index;
#X obj 1190 420 value _\$0_volume_L;
#X obj 1340 420 value _\$0_volume_R;
#X obj 1190 450 value _\$0_volume;
#X obj 820 640 value _\$0_waveform;
#X obj 130 410 value _\$0_waveform;
#X obj 30 800 value _\$0_volume_L;
#X obj 30 1030 value _\$0_volume_R;
#X text 1450 640 Works because each source/target wavetable covers
one octave;
#X obj 790 280 f;
#X obj 790 330 trigger b f;
#X obj 790 580 trigger b b;
#X obj 820 730 pack s f, f 60;
#X obj 820 789 s \$0-source-wavetable;
#X obj 820 510 s \$0-target-wavetable;
#X obj 820 610 trigger b b;
#X text 800 840 ---- Add harmonic waveform ----;
#X obj 810 1091 tabread4;
#X msg 880 1091 set \$1;
#X obj 810 1211 tabwrite;
#X obj 940 1211 r \$0-target-wavetable;
#X obj 1120 1091 tabread4;
#X msg 1190 1091 set \$1;
#X obj 940 1091 r \$0-source-wavetable;
#X obj 1250 1091 r \$0-target-wavetable;
#X obj 850 220 value _\$0_index;
#X obj 910 1031 value _\$0_index1;
#X obj 840 1181 value _\$0_index1;
#X obj 810 1151 trigger f b;
#X obj 810 1031 trigger f f f;
#X text 10 120 \$5 must be the maximum allowed number of harmonics.
, f 82;
#X obj 810 1121 expr ($f1 / \$5 * _\$0_volume) + \\$f2;
#X obj 790 890 expr size("$s1");
#X obj 930 860 r \$0-target-wavetable;
#X obj 790 860 symbol;
#X msg 850 860 symbol \$1;
#X msg 790 950 0 \$1;
#X obj 790 1001 ./utils/for-loop;
#X msg 820 480 symbol \$1-\$2-\$3;
#X msg 820 760 symbol wavetable-\$1\$2;
#X obj 1240 640 expr min(_\$0_index * \$4 \, \$5);
#X msg 880 1211 set \$1;
#X obj 810 1061 expr ($f1 * \$4) % _\$0_size;
#X obj 790 920 trigger f f;
#X obj 880 920 value _\$0_size;
#X obj 820 450 pack s s f, f 17;
#X obj 820 360 trigger b f b f;
#X obj 300 710 * -1;
#X obj 30 740 expr \\$f1 * \\$f2 * sqrt(($f3 + 1) / 2);
#X connect 3 0 18 0;
#X connect 7 0 46 0;
#X connect 8 0 53 0;
#X connect 9 0 48 0;
#X connect 10 0 49 0;
#X connect 18 0 4 0;
#X connect 18 1 19 0;
#X connect 19 0 22 0;
#X connect 20 0 73 0;
#X connect 21 0 54 0;
#X connect 21 1 55 0;
#X connect 22 0 20 0;
#X connect 22 1 89 0;
#X connect 23 0 109 0;
#X connect 27 0 30 0;
#X connect 28 0 31 0;
#X connect 29 0 32 0;
#X connect 30 0 112 0;
#X connect 31 0 35 0;
#X connect 32 0 36 0;
#X connect 33 0 51 0;
#X connect 35 0 112 0;
#X connect 35 1 112 1;
#X connect 36 0 112 0;
#X connect 36 1 111 0;
#X connect 37 0 40 0;
#X connect 38 0 41 0;
#X connect 39 0 42 0;
#X connect 40 0 33 0;
#X connect 41 0 43 0;
#X connect 42 0 44 0;
#X connect 43 0 33 0;
#X connect 43 1 33 1;
#X connect 44 0 33 0;
#X connect 44 1 33 2;
#X connect 46 0 63 0;
#X connect 47 0 63 0;
#X connect 48 0 63 0;
#X connect 49 0 63 0;
#X connect 50 0 70 0;
#X connect 51 0 71 0;
#X connect 52 0 65 0;
#X connect 52 1 66 0;
#X connect 53 0 69 0;
#X connect 53 1 69 0;
#X connect 54 0 109 1;
#X connect 55 0 109 1;
#X connect 56 0 57 0;
#X connect 56 1 59 0;
#X connect 56 2 60 0;
#X connect 56 3 61 0;
#X connect 57 0 76 0;
#X connect 59 0 76 0;
#X connect 60 0 76 0;
#X connect 61 0 76 0;
#X connect 63 0 13 0;
#X connect 64 0 109 2;
#X connect 65 0 67 0;
#X connect 66 0 67 0;
#X connect 68 0 56 0;
#X connect 69 0 47 0;
#X connect 73 0 74 0;
#X connect 74 0 75 0;
#X connect 74 1 110 0;
#X connect 75 0 98 0;
#X connect 75 1 79 0;
#X connect 76 0 103 0;
#X connect 79 0 68 0;
#X connect 79 1 104 0;
#X connect 81 0 95 0;
#X connect 82 0 81 0;
#X connect 84 0 105 0;
#X connect 85 0 95 1;
#X connect 86 0 85 0;
#X connect 87 0 82 0;
#X connect 88 0 86 0;
#X connect 91 0 83 1;
#X connect 92 0 83 0;
#X connect 92 1 91 0;
#X connect 93 0 106 0;
#X connect 93 1 85 0;
#X connect 93 2 90 0;
#X connect 95 0 92 0;
#X connect 96 0 107 0;
#X connect 97 0 99 0;
#X connect 98 0 96 0;
#X connect 99 0 98 1;
#X connect 100 0 101 0;
#X connect 101 0 93 0;
#X connect 102 0 78 0;
#X connect 103 0 77 0;
#X connect 104 0 76 1;
#X connect 105 0 83 0;
#X connect 106 0 81 0;
#X connect 107 0 100 0;
#X connect 107 1 108 0;
#X connect 109 0 102 0;
#X connect 110 0 23 0;
#X connect 110 1 21 0;
#X connect 110 2 64 0;
#X connect 110 3 52 0;
#X connect 111 0 112 2;
#X connect 112 0 50 0;
